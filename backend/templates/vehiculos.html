{% extends "base.html" %}
{% block content %}
    <h1>Veh√≠culos Registrados</h1>
    
    <!-- B√öSQUEDA Y FILTROS -->
    <div class="search-container">
        <form method="get" action="/vehiculos_web" class="search-form">
            <input type="text" name="buscar" placeholder="Buscar por matr√≠cula, modelo o marca..." value="{{buscar}}" style="flex:1; min-width:200px;">
            <select name="filtro_estado" style="padding:10px; border:2px solid #e0e0e0; border-radius:6px;">
                <option value="">Todos los estados</option>
                <option value="activo" {% if filtro_estado == 'activo' %}selected{% endif %}>Activo</option>
                <option value="inactivo" {% if filtro_estado == 'inactivo' %}selected{% endif %}>Inactivo</option>
                <option value="mantenimiento" {% if filtro_estado == 'mantenimiento' %}selected{% endif %}>Mantenimiento</option>
            </select>
            <button type="submit">Buscar</button>
            <a href="/vehiculos_web" style="background:#666; color:white; padding:10px 20px; border-radius:6px; text-decoration:none; text-align:center;">Limpiar</a>
        </form>
    </div>
    
    {% if error %}
        <div class="error">{{ error }}</div>
    {% endif %}
    
    <p class="result-count">Se encontraron {{vehiculos|length}} veh√≠culos</p>
    
    <table>
        <tr>
            <th>ID</th>
            <th>Matr√≠cula</th>
            <th>Modelo</th>
            <th>Tipo</th>
            <th>Marca</th>
            <th>Estado</th>
            <th>Capacidad</th>
            <th>Kilometraje</th>
            {% if usuario and usuario["rol"] == "admin" %}
                <th>Acciones</th>
            {% endif %}
        </tr>
        {% for v in vehiculos %}
        <tr>
            <td>{{ v.id_vehiculo }}</td>
            <td>{{ v.matricula }}</td>
            <td>{{ v.modelo }}</td>
            <td>{{ v.tipo }}</td>
            <td>{{ v.marca }}</td>
            <td>
                {% if v.estado == 'activo' %}
                    <span style="background:#4CAF50; color:white; padding:5px 10px; border-radius:4px; font-size:0.9em;">‚úÖ {{ v.estado }}</span>
                {% elif v.estado == 'inactivo' %}
                    <span style="background:#f44336; color:white; padding:5px 10px; border-radius:4px; font-size:0.9em;">‚ùå {{ v.estado }}</span>
                {% else %}
                    <span style="background:#FF9800; color:white; padding:5px 10px; border-radius:4px; font-size:0.9em;">üîß {{ v.estado }}</span>
                {% endif %}
            </td>
            <td>{{ v.capacidad }}</td>
            <td>{{ v.kilometraje }}</td>
            {% if usuario and usuario["rol"] == "admin" %}
                <td>
                    <a href="/vehiculos_edit/{{v.id_vehiculo}}" style="color:#336699; margin-right:10px;">Editar</a>
                    <a href="/vehiculos_delete/{{v.id_vehiculo}}" onclick="return confirm('¬øEliminar? Este veh√≠culo no debe tener registros vinculados.');" class="delete-btn"></a>
                </td>
            {% endif %}
        </tr>
        {% endfor %}
    </table>
    
    {% if not vehiculos %}
        <p style="text-align:center; color:#999; margin:30px 0;">No se encontraron veh√≠culos que coincidan con tu b√∫squeda.</p>
    {% endif %}
    
    {% if usuario and usuario["rol"] == "admin" %}
    <h2>Agregar Veh√≠culo</h2>
    <form method="post" action="/vehiculos_create">
        <input type="text" name="matricula" placeholder="Matr√≠cula (ej: ABC123)" maxlength="20" pattern="[A-Z0-9]{3,20}" title="Solo may√∫sculas y n√∫meros, 3-20 caracteres" required>
        <input type="text" name="modelo" placeholder="Modelo (ej: Sprinter 2020)" maxlength="50" pattern="[A-Za-z0-9\s\-]{1,50}" title="Solo letras, n√∫meros y espacios" required>
        <input type="text" name="tipo" placeholder="Tipo (ej: Camioneta, Cami√≥n, SUV)" maxlength="30" pattern="[A-Za-z√°√©√≠√≥√∫√Å√â√ç√ì√ö\s\-]{1,30}" title="Solo letras y espacios" required>
        <input type="number" name="capacidad" placeholder="Capacidad (litros o kg)" min="1" max="100000" title="Debe ser un n√∫mero entre 1 y 100000" required>
        <input type="text" name="marca" placeholder="Marca (ej: Mercedes-Benz)" maxlength="30" pattern="[A-Za-z√°√©√≠√≥√∫√Å√â√ç√ì√ö\s\-]{1,30}" title="Solo letras, espacios y guiones" required>
        <select name="estado" required>
            <option value="">Seleccionar estado</option>
            <option value="activo">Activo</option>
            <option value="inactivo">Inactivo</option>
            <option value="mantenimiento">Mantenimiento</option>
        </select>
        <input type="number" name="kilometraje" placeholder="Kilometraje actual" min="0" max="9999999" title="Debe ser un n√∫mero entre 0 y 9,999,999" required>
        <button type="submit">Agregar Veh√≠culo</button>
    </form>
    {% endif %}
{% endblock %}
