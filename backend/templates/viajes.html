{% extends "base.html" %}
{% block content %}
    <h1>Viajes Registrados</h1>
    
    <!-- BÃšSQUEDA Y FILTROS -->
    <div class="search-container">
        <form method="get" action="/viajes_web" class="search-form">
            <input type="text" name="buscar" placeholder="Buscar por origen o destino..." value="{{buscar}}" style="flex:1; min-width:200px;">
            <select name="filtro_estado" style="padding:10px; border:2px solid #e0e0e0; border-radius:6px;">
                <option value="">Todos los estados</option>
                <option value="pendiente" {% if filtro_estado == 'pendiente' %}selected{% endif %}>Pendiente</option>
                <option value="en progreso" {% if filtro_estado == 'en progreso' %}selected{% endif %}>En progreso</option>
                <option value="completado" {% if filtro_estado == 'completado' %}selected{% endif %}>Completado</option>
            </select>
            <button type="submit">Buscar</button>
            <a href="/viajes_web" style="background:#666; color:white; padding:10px 20px; border-radius:6px; text-decoration:none; text-align:center;">Limpiar</a>
        </form>
    </div>
    
    {% if error %}
        <div class="error">{{ error }}</div>
    {% endif %}
    
    <p class="result-count">Se encontraron {{viajes|length}} viajes</p>
    
    <table>
        <tr>
            <th>ID</th>
            <th>Origen</th>
            <th>Destino</th>
            <th>Fecha Salida</th>
            <th>Estado</th>
            {% if usuario and usuario["rol"] == "admin" %}
                <th>Acciones</th>
            {% endif %}
        </tr>
        {% for v in viajes %}
        <tr>
            <td>{{ v.id_viaje }}</td>
            <td>{{ v.origen }}</td>
            <td>{{ v.destino }}</td>
            <td>{{ v.fecha_salida }}</td>
            <td>
                {% if v.estado == 'completado' %}
                    <span style="background:#4CAF50; color:white; padding:5px 10px; border-radius:4px; font-size:0.9em;">âœ… {{ v.estado }}</span>
                {% elif v.estado == 'en progreso' %}
                    <span style="background:#2196F3; color:white; padding:5px 10px; border-radius:4px; font-size:0.9em;">ğŸš— {{ v.estado }}</span>
                {% else %}
                    <span style="background:#FF9800; color:white; padding:5px 10px; border-radius:4px; font-size:0.9em;">â³ {{ v.estado }}</span>
                {% endif %}
            </td>
            {% if usuario and usuario["rol"] == "admin" %}
                <td>
                    <a href="/viajes_edit/{{v.id_viaje}}" style="color:#336699; margin-right:10px;">âœï¸ Editar</a>
                    <a href="/viajes_delete/{{v.id_viaje}}" onclick="return confirm('Â¿Eliminar?');" class="delete-btn">ğŸ—‘ï¸</a>
                </td>
            {% endif %}
        </tr>
        {% endfor %}
    </table>
    
    {% if not viajes %}
        <p style="text-align:center; color:#999; margin:30px 0;">No se encontraron viajes que coincidan con tu bÃºsqueda.</p>
    {% endif %}
    
    {% if usuario and usuario["rol"] == "admin" %}
    <h2>Agregar Viaje</h2>
    <form method="post" action="/viajes_create">
        <input type="text" name="origen" placeholder="Origen (ej: CDMX)" required minlength="2" maxlength="50" pattern="[A-Za-zÃ¡Ã©Ã­Ã³ÃºÃÃ‰ÃÃ“Ãš\s\-]{2,50}" title="Solo letras, espacios y guiones, 2-50 caracteres">
        <input type="text" name="destino" placeholder="Destino (ej: Puebla)" required minlength="2" maxlength="50" pattern="[A-Za-zÃ¡Ã©Ã­Ã³ÃºÃÃ‰ÃÃ“Ãš\s\-]{2,50}" title="Solo letras, espacios y guiones, 2-50 caracteres">
        <input type="date" name="fecha_salida" required>
        <select name="estado" required>
            <option value="">Seleccionar estado</option>
            <option value="pendiente">Pendiente</option>
            <option value="en progreso">En progreso</option>
            <option value="completado">Completado</option>
        </select>
        <button type="submit">Agregar Viaje</button>
    </form>
    {% endif %}
{% endblock %}
