{# Vista de Flota: listado de flotas y asignación de vehículos (según rol).
    Extiende de base.html para estilos y navegación uniforme. #}
{% extends "base.html" %}
{% block content %}
    <h1>Flotas</h1>
    
    <!-- BÚSQUEDA (solo para admin) -->
    {% if usuario and usuario["rol"] == "admin" %}
    <div class="search-container">
        <form method="get" action="/flota_web" class="search-form">
            <input type="text" name="buscar" placeholder="Buscar por nombre..." value="{{buscar}}" style="flex:1; min-width:200px;">
            <button type="submit">Buscar</button>
            <a href="/flota_web" style="background:#666; color:white; padding:10px 20px; border-radius:6px; text-decoration:none; text-align:center;">Limpiar</a>
        </form>
    </div>
    {% endif %}
    
    <p style="text-align:center; color:#666;">Se encontraron {{flota|length}} flotas</p>
    
    <div style="overflow-x:auto;">
    <table>
        <tr>
            <th>ID</th>
            <th>Nombre</th>
            <th>Categoría</th>
            <th>Ubicación</th>
            <th>Estado</th>
            <th>Capacidad Máx.</th>
            <th>Fecha Creación</th>
            <th>Descripción</th>
            {% if usuario and usuario["rol"] == "admin" %}
                <th>Acciones</th>
            {% endif %}
        </tr>
        {% for f in flota %}
        <tr>
            <td>{{ f.id_flota }}</td>
            <td><strong>{{ f.nombre }}</strong></td>
            <td>
                {% if f.categoria == 'carga_ligera' %}
                    <span style="background:#4CAF50; color:white; padding:4px 8px; border-radius:4px; font-size:0.85em;">Carga Ligera</span>
                {% elif f.categoria == 'carga_pesada' %}
                    <span style="background:#F44336; color:white; padding:4px 8px; border-radius:4px; font-size:0.85em;">Carga Pesada</span>
                {% elif f.categoria == 'transporte_personal' %}
                    <span style="background:#2196F3; color:white; padding:4px 8px; border-radius:4px; font-size:0.85em;">Transporte Personal</span>
                {% elif f.categoria == 'reparto' %}
                    <span style="background:#FF9800; color:white; padding:4px 8px; border-radius:4px; font-size:0.85em;">Reparto</span>
                {% else %}
                    <span style="background:#9C27B0; color:white; padding:4px 8px; border-radius:4px; font-size:0.85em;">Especial</span>
                {% endif %}
            </td>
            <td>{{ f.ubicacion }}</td>
            <td>
                {% if f.estado == 'activa' %}
                    <span style="background:#4CAF50; color:white; padding:4px 8px; border-radius:4px; font-size:0.85em;">✓ Activa</span>
                {% elif f.estado == 'mantenimiento' %}
                    <span style="background:#FF9800; color:white; padding:4px 8px; border-radius:4px; font-size:0.85em;">⚙ Mantenimiento</span>
                {% else %}
                    <span style="background:#757575; color:white; padding:4px 8px; border-radius:4px; font-size:0.85em;">✗ Inactiva</span>
                {% endif %}
            </td>
            <td style="text-align:center;">{{ f.capacidad_maxima }}</td>
            <td>{{ f.fecha_creacion }}</td>
            <td style="max-width:200px; overflow:hidden; text-overflow:ellipsis;">{{ f.descripcion }}</td>
            {% if usuario and usuario["rol"] == "admin" %}
                <td>
                    <a href="/flota_edit/{{f.id_flota}}" style="color:#336699; margin-right:10px;">Editar</a>
                    <a href="/flota_delete/{{f.id_flota}}" onclick="return confirm('¿Eliminar?');" class="delete-btn">Eliminar</a>
                </td>
            {% endif %}
        </tr>
        {% endfor %}
    </table>
    </div>
    
    {% if not flota %}
        <p style="text-align:center; color:#999; margin:30px 0;">
            {% if usuario and usuario["rol"] == "conductor" %}
                No hay flotas asignadas a tus vehículos.
            {% else %}
                No se encontraron flotas que coincidan con tu búsqueda.
            {% endif %}
        </p>
    {% endif %}
    
    {% if usuario and usuario["rol"] == "admin" %}
    <h2 style="text-align:center; margin-top:40px;">Agregar Nueva Flota</h2>
    <form method="post" action="/flota_create" style="max-width:800px; margin:auto;">
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px;">
            <input type="text" name="nombre" placeholder="Nombre de la flota *" required minlength="2" maxlength="40">
            
            <select name="categoria" required>
                <option value="">Seleccionar categoría *</option>
                <option value="carga_ligera">Carga Ligera</option>
                <option value="carga_pesada">Carga Pesada</option>
                <option value="transporte_personal">Transporte Personal</option>
                <option value="reparto">Reparto</option>
                <option value="especial">Especial</option>
            </select>
            
            <input type="text" name="ubicacion" placeholder="Ubicación (ej: CDMX - Norte) *" required minlength="3" maxlength="100">
            
            <select name="estado" required>
                <option value="">Seleccionar estado *</option>
                <option value="activa" selected>Activa</option>
                <option value="inactiva">Inactiva</option>
                <option value="mantenimiento">Mantenimiento</option>
            </select>
            
            <input type="number" name="capacidad_maxima" placeholder="Capacidad máxima de vehículos" min="0" max="1000" value="0">
            
            <input type="date" name="fecha_creacion" required title="Fecha de creación de la flota">
        </div>
        
        <textarea name="descripcion" placeholder="Descripción de la flota *" required minlength="5" maxlength="100" rows="2" style="width:100%; margin-top:15px;"></textarea>
        
        <textarea name="politica_uso" placeholder="Políticas de uso (opcional - horarios, restricciones, requisitos especiales)" rows="4" style="width:100%; margin-top:15px;"></textarea>
        
        <button type="submit" style="width:100%; margin-top:15px;">Agregar Flota</button>
    </form>
    {% endif %}
{% endblock %}